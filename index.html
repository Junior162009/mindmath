<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Arcade Infantil</title>
<style>
  body { margin:0; font-family:sans-serif; background:#f0f9ff; }
  #loading { display:flex; align-items:center; justify-content:center; height:100vh; font-size:2em; animation: blink 1s infinite; }
  @keyframes blink { 50%{opacity:0.5;} }
  #game { display:none; flex-direction:column; height:100vh; }
  header { display:flex; justify-content:space-between; padding:10px; background:#4fc3f7; color:white; font-size:1.2em; }
  #menu { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:20px; }
  .btn { font-size:2em; padding:15px 30px; border:none; border-radius:15px; cursor:pointer; background:#81d4fa; color:#fff; }
  #nav { display:flex; justify-content:space-around; background:#0288d1; padding:10px; }
  #nav button { font-size:2em; background:none; border:none; color:white; cursor:pointer; }
  .hidden { display:none; }
</style>
</head>
<body>

<div id="loading">🎮 Cargando...</div>

<div id="game">
  <header>
    <div>⏱ <span id="time">30</span>s</div>
    <div>❤️ <span id="lives">3</span></div>
    <div>
      <button id="soundBtn">🔊</button>
      <button id="difficultyBtn">👶</button>
    </div>
  </header>
  <div id="menu">
    <button class="btn" onclick="startGame('menu')">🎮 Jugar Infinito</button>
    <button class="btn" onclick="startGame('memoria')">🧠 Memoria</button>
    <button class="btn" onclick="startGame('calculo')">⚡ Cálculo rápido</button>
    <button class="btn" onclick="startGame('sudoku')">🔢 Sudoku infantil</button>
    <button class="btn" onclick="startGame('suma')">➕ Suma simple</button>
    <button class="btn" onclick="showRanking()">⭐ Ranking</button>
  </div>
  <div id="gameArea" class="hidden"></div>
  <div id="ranking" class="hidden"></div>
  <div id="nav">
    <button onclick="goHome()">🏠</button>
  </div>
</div>

<script>
let ctx=new (window.AudioContext||window.webkitAudioContext)();
let bgOsc, bgPlaying=false, soundOn=true;
let time=30, lives=3, timer, score=0, difficulty="easy";
let ranking=JSON.parse(localStorage.getItem("ranking")||"[]");

function playSound(type){
  if(!soundOn) return;
  let o=ctx.createOscillator(), g=ctx.createGain();
  o.connect(g); g.connect(ctx.destination);
  if(type==="ding"){o.frequency.value=880;}
  if(type==="ok"){o.frequency.value=660;}
  if(type==="err"){o.frequency.value=220;}
  o.type="sine"; g.gain.setValueAtTime(0.1,ctx.currentTime);
  o.start(); o.stop(ctx.currentTime+0.3);
}

function toggleBg(){
  if(!soundOn){bgOsc?.stop(); bgPlaying=false; return;}
  if(bgPlaying) return;
  bgOsc=ctx.createOscillator(); let g=ctx.createGain();
  bgOsc.connect(g); g.connect(ctx.destination);
  bgOsc.type="triangle"; bgOsc.frequency.value=220;
  g.gain.setValueAtTime(0.03,ctx.currentTime);
  bgOsc.start(); bgPlaying=true;
}

function updateHUD(){
  document.getElementById("time").textContent=time;
  document.getElementById("lives").textContent=lives;
}

function startTimer(){
  clearInterval(timer);
  timer=setInterval(()=>{
    time--; updateHUD();
    if(time<=0) endGame();
  },1000);
}

function startGame(mode){
  score=0;
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("ranking").classList.add("hidden");
  let area=document.getElementById("gameArea");
  area.classList.remove("hidden"); area.innerHTML="";
  if(difficulty==="easy"){time=60; lives=5;}
  if(difficulty==="medium"){time=30; lives=3;}
  if(difficulty==="hard"){time=15; lives=2;}
  updateHUD(); startTimer();
  if(mode==="memoria"){area.innerHTML="🧠 Juego de Memoria (demo)";} 
  else if(mode==="calculo"){area.innerHTML="⚡ Juego de Cálculo (demo)";}
  else if(mode==="sudoku"){area.innerHTML="🔢 Sudoku Infantil (demo)";}
  else if(mode==="suma"){area.innerHTML="➕ Juego de Suma (demo)";}
  else {area.innerHTML="🎮 Juego Infinito (demo)";}
}

function endGame(){
  clearInterval(timer);
  playSound("err");
  alert("Fin del juego. Puntos: "+score);
  ranking.push({puntos:score, fecha:new Date().toLocaleString()});
  localStorage.setItem("ranking",JSON.stringify(ranking));
  goHome();
}

function goHome(){
  document.getElementById("gameArea").classList.add("hidden");
  document.getElementById("ranking").classList.add("hidden");
  document.getElementById("menu").classList.remove("hidden");
}

function showRanking(){
  document.getElementById("menu").classList.add("hidden");
  let r=document.getElementById("ranking");
  r.classList.remove("hidden");
  r.innerHTML="<h2>⭐ Ranking</h2>"+ranking.map(e=>"<div>"+e.puntos+" pts - "+e.fecha+"</div>").join("");
}

document.getElementById("soundBtn").onclick=()=>{
  soundOn=!soundOn;
  document.getElementById("soundBtn").textContent=soundOn?"🔊":"🔇";
  if(soundOn) toggleBg(); else{bgOsc?.stop(); bgPlaying=false;}
};

document.getElementById("difficultyBtn").onclick=()=>{
  if(difficulty==="easy"){difficulty="medium";document.getElementById("difficultyBtn").textContent="🧒";}
  else if(difficulty==="medium"){difficulty="hard";document.getElementById("difficultyBtn").textContent="👦";}
  else{difficulty="easy";document.getElementById("difficultyBtn").textContent="👶";}
};

window.onload=()=>{
  setTimeout(()=>{
    document.getElementById("loading").style.display="none";
    document.getElementById("game").style.display="flex";
    playSound("ding"); toggleBg();
  },2000);
};
</script>
</body>
</html>